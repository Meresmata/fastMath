#ifndef FASTMATH_H
#define FASTMATH_H

#define tanMaxIndex  17
#include <stdbool.h>
#include <limits.h>
#include <stdint.h>

namespace fastmath {

#ifdef Arduino_h

#include <avr/pgmspace.h>

	//results of cos_fn 
	const float CosArray[] PROGMEM = { 1.0, 0.999848, 0.999391, 0.998630, 0.997564,
		0.996195, 0.994522, 0.992546, 0.990268, 0.987688,
		0.984808, 0.981627, 0.978148, 0.974370, 0.970297,
		0.965926, 0.961262, 0.956305, 0.951057, 0.945519,
		0.939693, 0.933580, 0.927184, 0.920505, 0.913545,
		0.906308, 0.898794, 0.891007, 0.882948, 0.874620,
		0.866025, 0.857167, 0.848048, 0.838671, 0.829038,
		0.819152, 0.809017, 0.798636, 0.788011, 0.777146,
		0.766044, 0.754710, 0.743145, 0.731354, 0.719340,
		0.707107, 0.694658, 0.681998, 0.669131, 0.656059,
		0.642788, 0.629320, 0.615661, 0.601815, 0.587785,
		0.573576, 0.559193, 0.544639, 0.529919, 0.515038,
		0.500000, 0.484810, 0.469472, 0.453990, 0.438371,
		0.422618, 0.406737, 0.390731, 0.374607, 0.358368,
		0.342020, 0.325568, 0.309017, 0.292372, 0.275637,
		0.258819, 0.241922, 0.224951, 0.207912, 0.190809,
		0.173648, 0.156434, 0.139173, 0.121869, 0.104528,
		0.087156, 0.069756, 0.052336, 0.034899, 0.017452,
		0.000000 };

	//array to select right element of atanValues
	const unsigned int atanLimits[tanMaxIndex] = { 0, 324,       726,      1000,     1376,      1962,     2414,     3077,      4165,      6313,      8448,       12705,      16956,      25450,      28635,      38186,       57290 };

	/*atan = m x +n,
	m - second row
	n - first row*/
	const float atanValues[2][tanMaxIndex] = { { 0, 0.0202666, 0.15279,  0.285398, 0.466948,  0.695047, 0.824542, 0.962743,  1.10818,   1.25921,   1.33626,    1.41404,    1.45312,    1.49229,    1.50101,    1.51845,     1.55334 },
											 { 1, 0.904509,  0.654509, 0.50000,  0.345492,  0.206108, 0.146447, 0.0954921, 0.0544972, 0.0244721, 0.0138153,  0.00615603, 0.00346592, 0.00154143, 0.00121807, 0.000685301, 0 } };
#else

	const float PI = 3.1415926535897932384626433832795;

	//results of cos_fn 
	const float CosArray[] = { 1.0, 0.999848, 0.999391, 0.998630, 0.997564,
	0.996195, 0.994522, 0.992546, 0.990268, 0.987688,
	0.984808, 0.981627, 0.978148, 0.974370, 0.970297,
	0.965926, 0.961262, 0.956305, 0.951057, 0.945519,
	0.939693, 0.933580, 0.927184, 0.920505, 0.913545,
	0.906308, 0.898794, 0.891007, 0.882948, 0.874620,
	0.866025, 0.857167, 0.848048, 0.838671, 0.829038,
	0.819152, 0.809017, 0.798636, 0.788011, 0.777146,
	0.766044, 0.754710, 0.743145, 0.731354, 0.719340,
	0.707107, 0.694658, 0.681998, 0.669131, 0.656059,
	0.642788, 0.629320, 0.615661, 0.601815, 0.587785,
	0.573576, 0.559193, 0.544639, 0.529919, 0.515038,
	0.500000, 0.484810, 0.469472, 0.453990, 0.438371,
	0.422618, 0.406737, 0.390731, 0.374607, 0.358368,
	0.342020, 0.325568, 0.309017, 0.292372, 0.275637,
	0.258819, 0.241922, 0.224951, 0.207912, 0.190809,
	0.173648, 0.156434, 0.139173, 0.121869, 0.104528,
	0.087156, 0.069756, 0.052336, 0.034899, 0.017452,
	0.000000 };

	//array to select right element of atanValues
	const unsigned int atanLimits[tanMaxIndex] = { 0, 324,       726,      1000,     1376,     1962,     2414,     3077,      4165,      6313,      8448,      12705,      16956,      25450,      28635,      38186,       57290 };

	/*atan = m x +n,
	m - second row
	n - first row*/
	const float atanValues[2][tanMaxIndex] = { { 0, 0.0202666, 0.15279,  0.285398, 0.466948, 0.695047, 0.824542, 0.962743,  1.10818,   1.25921,   1.33626,   1.41404,    1.45312,    1.49229,    1.50101,    1.51845,     1.55334 },
											 { 1, 0.904509,  0.654509, 0.50000,  0.345492, 0.206108, 0.146447, 0.0954921, 0.0544972, 0.0244721, 0.0138153, 0.00615603, 0.00346592, 0.00154143, 0.00121807, 0.000685301, 0.0 } };

#endif

	//faster but less precise calculation of cosine
	//max error of 0.5° 
	float cos(float angle);

	//faster but less precise calculation of sin
	float inline sin(float angle) { return fastmath::cos((angle + PI)); };

	//faster but less precise calculation of tangens
	//average error: 0.08°
	//max. error: 0.6°
	float atan(float arcAngle);

	//faster but less precise calculation of tan2
	//average error: 0.2%°
	//max. error: 0.6°
	//if x and y nearly zero returns zero
	// if ownly y nearly zero returns +/- PI/2
	float atan2(const float x, const float y);

	//computes the absolute of any value, using templates
	template<typename inType = short>
	inType fAbs(inType x){
		if (x > 0)
			return x;
		else
			return (-x);
	};

	//computes degrees in RAD from DEG
	float inline toRad(float deg) { return (1.7453292519943295769e-2/*  PI/180  */)*deg; };

	//computes degrees in DEG from RAD
	float inline toDeg(float rad) { return  57.2957795130823208767 /*  180/PI   */ *rad; };
}//namespace fastmath
#endif // FASTMATH_H






